(function(v,w,d,k,c){function f(a){return d.translate(a)||a}var t={};c.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:!0,multiple_queues:!0,buttons:{browse:!0,start:!0,stop:!0},views:{list:!0,thumbs:!1,active:"list",remember:!0},autostart:!1,sortable:!1,rename:!1,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var a=this.element.attr("id");a||(a=d.guid(),this.element.attr("id",a));this.id=a;this.contents_bak=this.element.html();var b=this.element;b.id=b.attr("id");b.html('\x3cdiv class\x3d"plupload_wrapper"\x3e\x3cdiv class\x3d"ui-widget-content plupload_container"\x3e\x3cdiv class\x3d"ui-state-default ui-widget-header plupload_header"\x3e\x3cdiv class\x3d"plupload_header_content"\x3e\x3cdiv class\x3d"plupload_logo"\x3e \x3c/div\x3e\x3cdiv class\x3d"plupload_header_title"\x3e'+f("Select files")+'\x3c/div\x3e\x3cdiv class\x3d"plupload_header_text"\x3e'+f("Add files to the upload queue and click the start button.")+'\x3c/div\x3e\x3cdiv class\x3d"plupload_view_switch"\x3e\x3cinput type\x3d"radio" id\x3d"'+b.id+'_view_list" name\x3d"view_mode_'+b.id+'" checked\x3d"checked" /\x3e\x3clabel class\x3d"plupload_button" for\x3d"'+b.id+'_view_list" data-view\x3d"list"\x3e'+f("List")+'\x3c/label\x3e\x3cinput type\x3d"radio" id\x3d"'+b.id+'_view_thumbs" name\x3d"view_mode_'+b.id+'" /\x3e\x3clabel class\x3d"plupload_button"  for\x3d"'+b.id+'_view_thumbs" data-view\x3d"thumbs"\x3e'+f("Thumbnails")+'\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3ctable class\x3d"plupload_filelist plupload_filelist_header ui-widget-header"\x3e\x3ctr\x3e\x3ctd class\x3d"plupload_cell plupload_file_name"\x3e'+f("Filename")+'\x3c/td\x3e\x3ctd class\x3d"plupload_cell plupload_file_status"\x3e'+f("Status")+'\x3c/td\x3e\x3ctd class\x3d"plupload_cell plupload_file_size"\x3e'+f("Size")+'\x3c/td\x3e\x3ctd class\x3d"plupload_cell plupload_file_action"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3cdiv class\x3d"plupload_content"\x3e\x3cdiv class\x3d"plupload_droptext"\x3e'+f("Drag files here.")+'\x3c/div\x3e\x3cul class\x3d"plupload_filelist_content"\x3e \x3c/ul\x3e\x3cdiv class\x3d"plupload_clearer"\x3e\x26nbsp;\x3c/div\x3e\x3c/div\x3e\x3ctable class\x3d"plupload_filelist plupload_filelist_footer ui-widget-header"\x3e\x3ctr\x3e\x3ctd class\x3d"plupload_cell plupload_file_name"\x3e\x3cdiv class\x3d"plupload_buttons"\x3e\x3c!-- Visible --\x3e\x3ca class\x3d"plupload_button plupload_add"\x3e'+f("Add Files")+'\x3c/a\x3e\x26nbsp;\x3ca class\x3d"plupload_button plupload_start"\x3e'+f("Start Upload")+'\x3c/a\x3e\x26nbsp;\x3ca class\x3d"plupload_button plupload_stop plupload_hidden"\x3e'+f("Stop Upload")+'\x3c/a\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"plupload_started plupload_hidden"\x3e\x3c!-- Hidden --\x3e\x3cdiv class\x3d"plupload_progress plupload_right"\x3e\x3cdiv class\x3d"plupload_progress_container"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"plupload_cell plupload_upload_status"\x3e\x3c/div\x3e\x3cdiv class\x3d"plupload_clearer"\x3e\x26nbsp;\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"plupload_file_status"\x3e\x3cspan class\x3d"plupload_total_status"\x3e0%\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d"plupload_file_size"\x3e\x3cspan class\x3d"plupload_total_file_size"\x3e0 kb\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d"plupload_file_action"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cinput class\x3d"plupload_count" value\x3d"0" type\x3d"hidden"\x3e\x3c/div\x3e');this.container=c(".plupload_container",this.element).attr("id",a+"_container");this.content=c(".plupload_content",this.element);c.fn.resizable&&this.container.resizable({handles:"s",minHeight:300});this.filelist=c(".plupload_filelist_content",this.container).attr({id:a+"_filelist",unselectable:"on"});this.browse_button=c(".plupload_add",this.container).attr("id",a+"_browse");this.start_button=c(".plupload_start",this.container).attr("id",a+"_start");this.stop_button=c(".plupload_stop",this.container).attr("id",a+"_stop");this.thumbs_switcher=c("#"+a+"_view_thumbs");this.list_switcher=c("#"+a+"_view_list");c.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:!0}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}}),this.list_switcher.button({text:!1,icons:{secondary:"ui-icon-grip-dotted-horizontal"}}),this.thumbs_switcher.button({text:!1,icons:{secondary:"ui-icon-image"}}));this.progressbar=c(".plupload_progress_container",this.container);c.ui.progressbar&&this.progressbar.progressbar();this.counter=c(".plupload_count",this.element).attr({id:a+"_count",name:a+"_count"});this._initUploader()},_initUploader:function(){var a=this,b=this.id,h={container:b+"_buttons",browse_button:b+"_browse"};c(".plupload_buttons",this.element).attr("id",b+"_buttons");a.options.dragdrop&&(this.filelist.parent().attr("id",this.id+"_dropbox"),h.drop_element=this.id+"_dropbox");b=this.uploader=t[b]=new d.Uploader(c.extend(this.options,h));a.options.views.thumbs&&(b.settings.required_features.display_media=!0);b.bind("Error",function(b,c){var e,g="";e="\x3cstrong\x3e"+c.message+"\x3c/strong\x3e";switch(c.code){case d.FILE_EXTENSION_ERROR:g=k.sprintf(f("File: %s"),c.file.name);break;case d.FILE_SIZE_ERROR:g=k.sprintf(f("File: %s, size: %d, max file size: %d"),c.file.name,c.file.size,d.parseSize(a.options.max_file_size));break;case d.FILE_DUPLICATE_ERROR:g=k.sprintf(f("%s already present in the queue."),c.file.name);break;case a.FILE_COUNT_ERROR:g=k.sprintf(f("Upload element accepts only %d file(s) at a time. Extra files were stripped."),a.options.max_file_count);break;case d.IMAGE_FORMAT_ERROR:g=f("Image format either wrong or not supported.");break;case d.IMAGE_MEMORY_ERROR:g=f("Runtime ran out of available memory.");break;case d.HTTP_ERROR:g=f("Upload URL might be wrong or doesn't exist.")}e+=" \x3cbr /\x3e\x3ci\x3e"+g+"\x3c/i\x3e";a._trigger("error",null,{up:b,error:c});c.code===d.INIT_ERROR?setTimeout(function(){a.destroy()},1):a.notify("error",e)});b.bind("PostInit",function(b){a.options.buttons.browse?a.browse_button.button("enable"):(a.browse_button.button("disable").hide(),b.disableBrowse(!0));a.options.buttons.start||a.start_button.button("disable").hide();a.options.buttons.stop||a.stop_button.button("disable").hide();!a.options.unique_names&&a.options.rename&&a._enableRenaming();a.options.dragdrop&&b.features.dragdrop&&a.filelist.parent().addClass("plupload_dropbox");a._enableViewSwitcher();a.start_button.click(function(b){c(this).button("option","disabled")||a.start();b.preventDefault()});a.stop_button.click(function(b){a.stop();b.preventDefault()});a._trigger("ready",null,{up:b})});a.options.max_file_count&&(a.options.multiple_queues=!1,b.bind("FilesAdded",function(b,c){var e=c.length,g=b.files.length+e-a.options.max_file_count;0<g&&(c.splice(e-g,g),b.trigger("Error",{code:a.FILE_COUNT_ERROR,message:f("File count error.")}))}));b.init();b.bind("FileFiltered",function(b,c){a._addFiles(c)});b.bind("FilesAdded",function(b,g){a._trigger("selected",null,{up:b,files:g});a.options.sortable&&c.ui.sortable&&a._enableSortingList();a._trigger("updatelist",null,{filelist:a.filelist});a.options.autostart&&setTimeout(function(){a.start()},10)});b.bind("FilesRemoved",function(b,c){a._trigger("removed",null,{up:b,files:c})});b.bind("QueueChanged StateChanged",function(){a._handleState()});b.bind("UploadFile",function(b,c){a._handleFileStatus(c)});b.bind("FileUploaded",function(b,c){a._handleFileStatus(c);a._trigger("uploaded",null,{up:b,file:c})});b.bind("UploadProgress",function(b,c){a._handleFileStatus(c);a._updateTotalProgress();a._trigger("progress",null,{up:b,file:c})});b.bind("UploadComplete",function(b,c){a._addFormFields();a._trigger("complete",null,{up:b,files:c})})},_setOption:function(a,b){"buttons"==a&&"object"==typeof b&&(b=c.extend(this.options.buttons,b),b.browse?(this.browse_button.button("enable").show(),this.uploader.disableBrowse(!1)):(this.browse_button.button("disable").hide(),this.uploader.disableBrowse(!0)),b.start?this.start_button.button("enable").show():this.start_button.button("disable").hide(),b.stop?this.start_button.button("enable").show():this.stop_button.button("disable").hide());this.uploader.settings[a]=b},start:function(){this.uploader.start();this._trigger("start",null,{up:this.uploader})},stop:function(){this.uploader.stop();this._trigger("stop",null,{up:this.uploader})},enable:function(){this.browse_button.button("enable");this.uploader.disableBrowse(!1)},disable:function(){this.browse_button.button("disable");this.uploader.disableBrowse(!0)},getFile:function(a){return"number"===typeof a?this.uploader.files[a]:this.uploader.getFile(a)},getFiles:function(){return this.uploader.files},removeFile:function(a){"string"===d.typeOf(a)&&(a=this.getFile(a));this._removeFiles(a)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(a,b){var h=c('\x3cdiv class\x3d"plupload_message"\x3e\x3cspan class\x3d"plupload_message_close ui-icon ui-icon-circle-close" title\x3d"'+f("Close")+'"\x3e\x3c/span\x3e\x3cp\x3e\x3cspan class\x3d"ui-icon"\x3e\x3c/span\x3e'+b+"\x3c/p\x3e\x3c/div\x3e");h.addClass("ui-state-"+("error"===a?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+("error"===a?"alert":"info")).end().find(".plupload_message_close").click(function(){h.remove()}).end();c(".plupload_header",this.container).append(h)},destroy:function(){this._removeFiles([].slice.call(this.uploader.files));this.uploader.destroy();c(".plupload_button",this.element).unbind();c.ui.button&&c(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy");c.ui.progressbar&&this.progressbar.progressbar("destroy");c.ui.sortable&&this.options.sortable&&c("tbody",this.filelist).sortable("destroy");this.element.empty().html(this.contents_bak);this.contents_bak="";c.Widget.prototype.destroy.apply(this)},_handleState:function(){var a=this.uploader;a.state===d.STARTED?(c(this.start_button).button("disable"),c([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden"),c(".plupload_upload_status",this.element).html(k.sprintf(f("Uploaded %d/%d files"),a.total.uploaded,a.files.length)),c(".plupload_header_content",this.element).addClass("plupload_header_content_bw")):a.state===d.STOPPED&&(c([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden"),this.options.multiple_queues?c(".plupload_header_content",this.element).removeClass("plupload_header_content_bw"):(c([]).add(this.browse_button).add(this.start_button).button("disable"),a.disableBrowse()),a.files.length===a.total.uploaded+a.total.failed?this.start_button.button("disable"):this.start_button.button("enable"),this._updateTotalProgress());0===a.total.queued?c(".ui-button-text",this.browse_button).html(f("Add Files")):c(".ui-button-text",this.browse_button).html(k.sprintf(f("%d files queued"),a.total.queued));a.refresh()},_handleFileStatus:function(a){var b=this,h,e;if(c("#"+a.id).length){switch(a.status){case d.DONE:h="plupload_done";e="ui-icon ui-icon-circle-check";break;case d.FAILED:h="ui-state-error plupload_failed";e="ui-icon ui-icon-alert";break;case d.QUEUED:h="plupload_delete";e="ui-icon ui-icon-circle-minus";break;case d.UPLOADING:h="ui-state-highlight plupload_uploading";e="ui-icon ui-icon-circle-arrow-w";var g=c(".plupload_scroll",this.container),f=g.scrollTop(),q=g.height(),k=c("#"+a.id).position().top+c("#"+a.id).height();q<k&&g.scrollTop(f+k-q);c("#"+a.id).find(".plupload_file_percent").html(a.percent+"%").end().find(".plupload_file_progress").css("width",a.percent+"%").end().find(".plupload_file_size").html(d.formatSize(a.size))}h+=" ui-state-default plupload_file";c("#"+a.id).attr("class",h).find(".ui-icon").attr("class",e).end().filter(".plupload_delete, .plupload_done, .plupload_failed").find(".ui-icon").click(function(c){b._removeFiles(a);c.preventDefault()})}},_updateTotalProgress:function(){var a=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight;this.progressbar.progressbar("value",a.total.percent);this.element.find(".plupload_total_status").html(a.total.percent+"%").end().find(".plupload_total_file_size").html(d.formatSize(a.total.size)).end().find(".plupload_upload_status").html(k.sprintf(f("Uploaded %d/%d files"),a.total.uploaded,a.files.length))},_displayThumbs:function(){function a(a,b,c){var d;a.on(b,function(){clearTimeout(d);d=setTimeout(function(){clearTimeout(d);c()},300)})}function b(){var a=Math.floor(d.content.scrollTop()/l)*m;n=c(".plupload_file",d.filelist).slice(a,a+r).filter(":not(.plupload_file_thumb_loaded)").get()}function h(){function e(){if("thumbs"===d.view_mode){if(!f||!l){var a=c(".plupload_file:eq(0)",d.filelist);f=a.outerWidth(!0);l=a.outerHeight(!0)}var a=d.content.width(),e=d.content.height();m=Math.floor(a/f);r=m*(Math.ceil(e/l)+1);b();g()}}c.fn.resizable&&a(d.container,"resize",e);a(d.window,"resize",e);a(d.content,"scroll",e);d.element.on("viewchanged selected",e);e()}function e(a,b){var e=new k.Image;e.onload=function(){var b=c("#"+a.id+" .plupload_file_thumb",d.filelist).html("");this.embed(b[0],{width:100,height:60,crop:!0,swf_url:k.resolveUrl(d.options.flash_swf_url),xap_url:k.resolveUrl(d.options.silverlight_xap_url)})};e.bind("embedded error",function(){c("#"+a.id,d.filelist).addClass("plupload_file_thumb_loaded");this.destroy();setTimeout(b,1)});e.load(a.getSource())}function g(){"thumbs"!==d.view_mode||p||(b(),n.length&&(p=!0,e(d.getFile(c(n.shift()).attr("id")),function(){p=!1;g()})))}var d=this,f,l,m,r=0,n=[],p=!1;if(this.options.views.thumbs)this.element.on("selected",function u(){d.element.off("selected",u);h()})},_addFiles:function(a){var b=this;"array"!==d.typeOf(a)&&(a=[a]);c.each(a,function(a,c){var e=k.Mime.getFileExtension(c.name)||"none";b.filelist.append('\x3cli class\x3d"plupload_file ui-state-default" id\x3d"%id%"\x3e\x3cdiv class\x3d"plupload_file_thumb"\x3e\x3cdiv class\x3d"plupload_file_dummy ui-widget-content"\x3e\x3cspan class\x3d"ui-state-disabled"\x3e%ext%\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"plupload_file_name" title\x3d"%name%"\x3e\x3cspan class\x3d"plupload_file_namespan"\x3e%name%\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"plupload_file_action"\x3e\x3cdiv class\x3d"ui-icon"\x3e \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"plupload_file_size"\x3e%size% \x3c/div\x3e\x3cdiv class\x3d"plupload_file_status"\x3e\x3cdiv class\x3d"plupload_file_progress ui-widget-header" style\x3d"width: 0%"\x3e \x3c/div\x3e\x3cspan class\x3d"plupload_file_percent"\x3e%percent% \x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"plupload_file_fields"\x3e \x3c/div\x3e\x3c/li\x3e'.replace(/%(\w+)%/g,function(a,b){return"size"===b?d.formatSize(c.size):"ext"===b?e:c[b]||""}));b._handleFileStatus(c)})},_removeFiles:function(a){var b=this.uploader;"array"!==d.typeOf(a)&&(a=[a]);c.ui.sortable&&this.options.sortable&&c("tbody",this.filelist).sortable("destroy");c.each(a,function(a,d){c("#"+d.id).toggle("highlight",function(){this.remove()});b.removeFile(d)});b.files.length&&this.options.sortable&&c.ui.sortable&&this._enableSortingList();this._trigger("updatelist",null,{filelist:this.filelist})},_addFormFields:function(){var a=this;c(".plupload_file_fields",this.filelist).html("");d.each(this.uploader.files,function(b,h){var e="",g=a.id+"_"+h;b.target_name&&(e+='\x3cinput type\x3d"hidden" name\x3d"'+g+'_tmpname" value\x3d"'+d.xmlEncode(b.target_name)+'" /\x3e');e+='\x3cinput type\x3d"hidden" name\x3d"'+g+'_name" value\x3d"'+d.xmlEncode(b.name)+'" /\x3e';e+='\x3cinput type\x3d"hidden" name\x3d"'+g+'_status" value\x3d"'+(b.status===d.DONE?"done":"failed")+'" /\x3e';c("#"+b.id).find(".plupload_file_fields").html(e)});this.counter.val(this.uploader.files.length)},_viewChanged:function(a){this.options.views.remember&&c.cookie&&c.cookie("plupload_ui_view",a,{expires:7,path:"/"});"IE"===k.Env.browser&&7>k.Env.version&&this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+("list"===a?133:103)+");");this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+a);this.view_mode=a;this._trigger("viewchanged",null,{view:a})},_enableViewSwitcher:function(){var a=this,b,h=c(".plupload_view_switch",this.container),e;d.each(["list","thumbs"],function(b){a.options.views[b]||h.find('[for\x3d"'+a.id+"_view_"+b+'"], #'+a.id+"_view_"+b).remove()});e=h.find(".plupload_button");1===e.length?(h.hide(),b=e.eq(0).data("view"),this._viewChanged(b)):c.ui.button&&1<e.length?(this.options.views.remember&&c.cookie&&(b=c.cookie("plupload_ui_view")),~d.inArray(b,["list","thumbs"])||(b=this.options.views.active),h.show().buttonset().find(".ui-button").click(function(d){b=c(this).data("view");a._viewChanged(b);d.preventDefault()}),e=h.find('[for\x3d"'+a.id+"_view_"+b+'"]'),e.length&&e.trigger("click")):(h.show(),this._viewChanged(this.options.views.active));this.options.views.thumbs&&this._displayThumbs()},_enableRenaming:function(){var a=this;this.filelist.dblclick(function(b){var d=c(b.target),e,f,k="";if(d.hasClass("plupload_file_namespan")){e=a.uploader.getFile(d.closest(".plupload_file")[0].id);f=e.name;if(b=/^(.+)(\.[^.]+)$/.exec(f))f=b[1],k=b[2];c('\x3cinput class\x3d"plupload_file_rename" type\x3d"text" /\x3e').width(d.width()).insertAfter(d.hide()).val(f).blur(function(){d.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(a){var b=c(this);-1!==c.inArray(a.keyCode,[13,27])&&(a.preventDefault(),13===a.keyCode&&(e.name=b.val()+k,d.html(e.name)),b.blur())})[0].focus()}})},_enableSortingList:function(){var a=this;2>c(".plupload_file",this.filelist).length||(c("tbody",this.filelist).sortable("destroy"),this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var b=[];c.each(c(this).sortable("toArray"),function(c,d){b[b.length]=a.uploader.getFile(d)});b.unshift(b.length);b.unshift(0);Array.prototype.splice.apply(a.uploader.files,b)}}))}})})(window,document,plupload,mOxie,jQuery);